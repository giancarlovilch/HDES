{% extends 'schedule/base.html' %}

{% block content %}
<div class="container">
    <div class="assignment-form">
        <h2>Nueva Asignación</h2>
        <form method="post" action="">
            {% csrf_token %}
            <div class="form-group">
                <label for="worker">Trabajador:</label>
                <select name="worker" id="worker" required>
                    <option value="">Selecciona un trabajador</option>
                    {% for w in workers %}
                        <option value="{{ w.id }}">{{ w.name }}</option>
                    {% empty %}
                        <option value="">No hay trabajadores disponibles</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="seat">Asiento disponible:</label>
                <select name="seat" id="seat" required>
                    <option value="">Selecciona un asiento</option>
                    {% for day in days %}
                        {% for seat in day.seats.all %}
                            {% if not seat.worker %}
                                <option value="{{ seat.id }}">
                                    {{ day.get_day_of_week_display }} - Turno {{ seat.position }}
                                </option>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Asignar</button>
        </form>
    </div>

    <div class="calendar-container">
        <h2>Semana Actual</h2>
        <div class="calendar">
            {% for day in days %}
                <div class="day">
                    <div class="day-header">{{ day.get_day_of_week_display }}</div>
                    {% for seat in day.seats.all %}
                        <div class="time-slot {% if seat.worker %}occupied{% else %}vacant{% endif %}">
                            <span class="slot-time">Turno {{ seat.position }}:</span>
                            <span class="slot-worker">
                                {% if seat.worker %}
                                    {{ seat.worker.name }}
                                {% else %}
                                    Vacante
                                {% endif %}
                            </span>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="reset-section">
    <form method="post" action="{% url 'schedule:reset_assignments' %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-delete" onclick="return confirm('¿Estás seguro de que quieres reiniciar todas las asignaciones?')">
            Reiniciar Todas las Asignaciones
        </button>
    </form>
</div>
{% endblock %}